{"ast":null,"code":"import axios from 'axios';\nconst baseURL = 'http://127.0.0.1:8000/api/';\nconst axiosInstance = axios.create({\n  baseURL: baseURL,\n  timeout: 5000,\n  headers: {\n    'Authorization': localStorage.getItem('access_token') ? \"JWT \" + localStorage.getItem('access_token') : null,\n    'Content-Type': 'application/json',\n    'accept': 'application/json'\n  }\n});\naxiosInstance.interceptors.response.use(response => response, error => {\n  const originalRequest = error.config; // Prevent infinite loops early\n\n  if (error.response.status === 401 && originalRequest.url === baseURL + 'token/refresh/') {\n    window.location.href = '/login/';\n    return Promise.reject(error);\n  }\n\n  if (error.response.data.code === \"token_not_valid\" && error.response.status === 401 && error.response.statusText === \"Unauthorized\") {\n    const refreshToken = localStorage.getItem('refresh_token');\n\n    if (refreshToken) {\n      const tokenParts = JSON.parse(atob(refreshToken.split('.')[1])); // exp date in token is expressed in seconds, while now() returns milliseconds:\n\n      const now = Math.ceil(Date.now() / 1000);\n      console.log(tokenParts.exp);\n\n      if (tokenParts.exp > now) {\n        return axiosInstance.post('/token/refresh/', {\n          refresh: refreshToken\n        }).then(response => {\n          localStorage.setItem('access_token', response.data.access);\n          localStorage.setItem('refresh_token', response.data.refresh);\n          axiosInstance.defaults.headers['Authorization'] = \"JWT \" + response.data.access;\n          originalRequest.headers['Authorization'] = \"JWT \" + response.data.access;\n          return axiosInstance(originalRequest);\n        }).catch(err => {\n          console.log(err);\n        });\n      } else {\n        console.log(\"Refresh token is expired\", tokenParts.exp, now);\n        window.location.href = '/login/';\n      }\n    } else {\n      console.log(\"Refresh token not available.\");\n      window.location.href = '/login/';\n    }\n  } // specific error handling done elsewhere\n\n\n  return Promise.reject(error);\n});\nexport default axiosInstance;","map":{"version":3,"sources":["S:/Parking Management System/Parking-Management-System/frontend/react-frontend/src/Axios/AxiosInstance.js"],"names":["axios","baseURL","axiosInstance","create","timeout","headers","localStorage","getItem","interceptors","response","use","error","originalRequest","config","status","url","window","location","href","Promise","reject","data","code","statusText","refreshToken","tokenParts","JSON","parse","atob","split","now","Math","ceil","Date","console","log","exp","post","refresh","then","setItem","access","defaults","catch","err"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\n\r\n\r\nconst baseURL = 'http://127.0.0.1:8000/api/'\r\n\r\n\r\nconst axiosInstance = axios.create({\r\n    baseURL: baseURL,\r\n    timeout: 5000,\r\n    headers: {\r\n        'Authorization': localStorage.getItem('access_token') ? \"JWT \" + localStorage.getItem('access_token') : null,\r\n        'Content-Type': 'application/json',\r\n        'accept': 'application/json'\r\n    }\r\n})\r\n\r\n\r\naxiosInstance.interceptors.response.use(\r\n    response => response,\r\n    error => {\r\n        const originalRequest = error.config;\r\n\r\n        // Prevent infinite loops early\r\n        if (error.response.status === 401 && originalRequest.url === baseURL+'token/refresh/') {\r\n            window.location.href = '/login/';\r\n            return Promise.reject(error);\r\n        }\r\n\r\n        if (error.response.data.code === \"token_not_valid\" &&\r\n            error.response.status === 401 && \r\n            error.response.statusText === \"Unauthorized\") \r\n            {\r\n                const refreshToken = localStorage.getItem('refresh_token');\r\n\r\n                if (refreshToken){\r\n                    const tokenParts = JSON.parse(atob(refreshToken.split('.')[1]));\r\n\r\n                    // exp date in token is expressed in seconds, while now() returns milliseconds:\r\n                    const now = Math.ceil(Date.now() / 1000);\r\n                    console.log(tokenParts.exp);\r\n\r\n                    if (tokenParts.exp > now) {\r\n                        return axiosInstance\r\n                        .post('/token/refresh/', {refresh: refreshToken})\r\n                        .then((response) => {\r\n            \r\n                            localStorage.setItem('access_token', response.data.access);\r\n                            localStorage.setItem('refresh_token', response.data.refresh);\r\n            \r\n                            axiosInstance.defaults.headers['Authorization'] = \"JWT \" + response.data.access;\r\n                            originalRequest.headers['Authorization'] = \"JWT \" + response.data.access;\r\n            \r\n                            return axiosInstance(originalRequest);\r\n                        })\r\n                        .catch(err => {\r\n                            console.log(err)\r\n                        });\r\n                    }else{\r\n                        console.log(\"Refresh token is expired\", tokenParts.exp, now);\r\n                        window.location.href = '/login/';\r\n                    }\r\n                }else{\r\n                    console.log(\"Refresh token not available.\")\r\n                    window.location.href = '/login/';\r\n                }\r\n        }\r\n      \r\n     \r\n      // specific error handling done elsewhere\r\n      return Promise.reject(error);\r\n  }\r\n);\r\n\r\n\r\n\r\nexport default axiosInstance"]},"metadata":{},"sourceType":"module"}